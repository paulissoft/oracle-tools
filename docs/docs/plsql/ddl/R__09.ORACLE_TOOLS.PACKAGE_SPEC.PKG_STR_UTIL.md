<!-- DO NOT EDIT THIS FILE DIRECTLY - it is generated from source file db/app/ddl/src/full/R__09.ORACLE_TOOLS.PACKAGE_SPEC.PKG_STR_UTIL.sql -->
<!-- markdownlint-disable MD003 MD012 MD024 MD033 -->

- [Package "ORACLE_TOOLS"."PKG_STR_UTIL"](#package-oracle_toolspkg_str_util)
- [Function dbms_lob_substr](#function-dbms_lob_substr)
- [Function dbms_lob$substr](#function-dbms_lobsubstr)
- [Procedure split](#procedure-split)
- [Procedure join](#procedure-join)
- [Procedure trim](#procedure-trim)
- [Function compare](#function-compare)
- [Procedure compare](#procedure-compare)
- [Procedure compare](#procedure-compare-1)
- [Procedure compare](#procedure-compare-2)
- [Procedure append_text](#procedure-append_text)
- [Procedure append_text](#procedure-append_text-1)
- [Procedure text2clob](#procedure-text2clob)
- [Function clob2text](#function-clob2text)


# Package "ORACLE_TOOLS"."PKG_STR_UTIL"

String utilities.

SIGNATURE

```sql
PACKAGE "ORACLE_TOOLS"."PKG_STR_UTIL" AUTHID DEFINER IS /* -*-coding: utf-8-*- */
```


## Function dbms_lob_substr

An enhancement for dbms_lob.substr().

It appears that dbms_lob.substr(amount => 32767) returns at most 32764 characters.

This function corrects that.

SIGNATURE

```sql
function dbms_lob_substr
( p_clob in clob
, p_amount in naturaln := c_max_varchar2_size
, p_offset in positiven := 1
, p_check in varchar2 default 'O' -- check for buffer (O)verflow and/or (L)ength returned equal to the amount requested
)
return varchar2;
```


## Function dbms_lob$substr

An enhancement for dbms_lob.substr().

Invokes dbms_lob_substr(..., p_check => null), i.e. no check for buffer overflow nor length returned equal to the amount requested.

SIGNATURE

```sql
function dbms_lob$substr
( p_clob in clob
, p_amount in naturaln := c_max_varchar2_size
, p_offset in positiven := 1
)
return varchar2;
```


## Procedure split

Split a string separated by a delimiter string.

SIGNATURE

```sql
procedure split
( p_str in clob
, p_delimiter in varchar2 := ',' -- The separator string.
, p_str_tab out nocopy t_clob_tab -- The output table.
);
```


## Procedure join

Join a string separated by a delimiter string.

SIGNATURE

```sql
procedure join
( p_str_tab in dbms_sql.varchar2a -- The input table.
, p_delimiter in varchar2 := ',' -- The separator string.
, p_str out nocopy clob
);
```


## Procedure trim

Removes left and right from the input table all characters in a set.
All null elements will be removed.

SIGNATURE

```sql
procedure trim
( p_str_tab in out nocopy t_clob_tab -- A string collection.
, p_set in varchar2 := ' ' -- The set of characters to remove from the begin and end.
);
```


## Function compare

Compare two CLOB collections and returns 0 if totally equal (count and each element).

Returns:
- -1 if p_str1_tab.count < p_str2_tab.count or
             p_str1_tab.count = p_str2_tab.count and there is a row R for which
             dbms_lob.compare(p_str1_tab(R), p_str2_tab(R)) < 0 and
             for all rows R' < R dbms_lob.compare(p_str1_tab(R'), p_str2_tab(R')) = 0
- 0 if p_str1_tab.count = p_str2_tab.count and
             for all rows R dbms_lob.compare(p_str1_tab(R), p_str2_tab(R)) = 0
- 1 if p_str1_tab.count > p_str2_tab.count or
             if p_str1_tab.count = p_str2_tab.count and there is a row R with
             dbms_lob.compare(p_str1_tab(R), p_str2_tab(R)) > 0 and
             for all rows R' < R dbms_lob.compare(p_str1_tab(R'), p_str2_tab(R')) = 0

May throw ORA-06531  Reference to an uninitialized collection

SIGNATURE

```sql
function compare
( p_str1_tab in t_clob_tab -- The first CLOB collection.
, p_str2_tab in t_clob_tab -- The second CLOB collection.
)
return integer;
```


## Procedure compare

Compares two CLOB collections.

The output parameter p_first_char_not_equal will be:
- NULL when no differences or one collection is a sub set of the other (but not equal).
- Not NULL if there is a row R and character position C for which:
  dbms_lob.substr(lob_loc => p_str1_tab(R), offset => C, amount => 1) !=
  dbms_lob.substr(lob_loc => p_str2_tab(R), offset => C, amount => 1)

May throw ORA-06531  Reference to uninitialized collection

SIGNATURE

```sql
procedure compare
( p_str1_tab in t_clob_tab -- The first CLOB collection.
, p_str2_tab in t_clob_tab -- The second CLOB collection.
, p_first_line_not_equal out binary_integer -- The first line not equal (null when there are no differences).
, p_first_char_not_equal out binary_integer -- The first character position that differs for line p_first_line_not_equal.
);
```


## Procedure compare

Compare two line arrays and return diff like results.

The idea is that the output shows you how to turn the source into the target, i.e. which lines have to be added or removed.

The code is taken from Diff.java, Copyright Â© 2000-2017, Robert Sedgewick and Kevin Wayne.
Originally found on http://introcs.cs.princeton.edu/java/96optimization/Diff.java.html
but it seems now to reside on https://introcs.cs.princeton.edu/java/23recursion/Diff.java.html.

The output format is:

  [source line index][target line index][marker] line

where marker is one of '=', '-' or '+'. 
Line is the source line if marker is '-' (remove) and the target line if marker is '+' (add). 
When marker is '=' both the source and target line are equal so it is one of those.
The line displayed is converted to base64 when the parameter p_convert_to_base64 equals true.

SIGNATURE

```sql
procedure compare
( p_source_line_tab in dbms_sql.varchar2a -- The source lines
, p_target_line_tab in dbms_sql.varchar2a -- The target lines
, p_stop_after_first_diff in boolean default false -- Stop after the first difference?
, p_show_equal_lines in boolean default true -- Show equal lines?
, p_convert_to_base64 in boolean default false -- Convert a line to base64 (hex) while displaying differences?
, p_compare_line_tab out nocopy dbms_sql.varchar2a -- The comparison
);
```


## Procedure compare

Compare two CLOBs, split them by a delimiter and return diff like results.

See compare() above.

SIGNATURE

```sql
procedure compare
( p_source in clob -- The source CLOB 
, p_target in clob -- The target CLOB 
, p_delimiter in varchar2 default chr(10) -- The delimiter to split by
, p_stop_after_first_diff in boolean default false -- Stop after the first difference?
, p_show_equal_lines in boolean default true -- Show equal lines?
, p_convert_to_base64 in boolean default false -- Convert a line to base64 (hex) while displaying differences?
, p_compare_line_tab out nocopy dbms_sql.varchar2a -- The comparison
);
```


## Procedure append_text

Append a buffer to a CLOB using dbms_lob.writeappend().

SIGNATURE

```sql
procedure append_text
( pi_buffer in varchar2 -- The buffer.
, pio_clob in out nocopy clob -- The CLOB.
);
```


## Procedure append_text

Append a text to a buffer and flush the buffer to a CLOB when full.

See also http://www.talkapex.com/2009/06/how-to-quickly-append-varchar2-to-clob.html

SIGNATURE

```sql
procedure append_text
( pi_text in varchar2 -- The text to write to the buffer.
, pio_buffer in out nocopy varchar2 -- The buffer that, when full, is flushed to the CLOB.
, pio_clob in out nocopy clob -- The CLOB.
);
```


## Procedure text2clob

Write or append a text collection to a CLOB.

SIGNATURE

```sql
procedure text2clob
( pi_text_tab in oracle_tools.t_text_tab -- The text collection.
, pio_clob in out nocopy clob -- The CLOB. If null a temporary is created.
, pi_append in boolean := false -- Should we append or not? If not the CLOB will be trimmed to zero bytes.
);
```


## Function clob2text

Write or append a text collection to a CLOB.

SIGNATURE

```sql
function clob2text
( pi_clob in clob -- The CLOB. If null a temporary is created.
, pi_trim in naturaln default 0 -- Trim at both ends?
)
return oracle_tools.t_text_tab;
```


